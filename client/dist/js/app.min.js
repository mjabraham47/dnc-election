angular.module("dncElection").config(function(a,b,c,d,e){a.state("about",{url:"/about",templateUrl:"templates/about.html",resolve:{candidates:function(a){return a.getCandidates()}},controller:"AboutCtrl"}).state("candidates",{url:"/candidates",templateUrl:"templates/candidates.html",resolve:{candidates:function(a){return a.getCandidates()}},controller:function(a,b){a.candidates=b}}).state("candidates.overview",{url:"/overview",templateUrl:"templates/candidateOverview.html",resolve:{},controller:function(){}}).state("candidates.detail",{url:"/:id",templateUrl:"templates/candidateDetail.html",resolve:{candidate:function(a,b,c){return c.find(b,{_id:a.id})}},controller:"CandidatesCtrl"}).state("elector",{url:"/elector",templateUrl:"templates/elector.html",controller:"ElectorCtrl"}).state("electorResults",{url:"/elector/results",params:{userId:null,created:!1,candidate:null},resolve:{electors:function(a,b){return a.getElectors(b.userId)},created:function(a){return a.created},candidate:function(a){return a.candidate}},templateUrl:"templates/elector-results.html",controller:"ElectorResultsCtrl"}).state("results",{url:"/results",templateUrl:"templates/results.html",controller:"ResultsCtrl",controllerAs:"resultsCtrl",resolve:{results:function(a){return a.getCandidates().then(function(a){var b=0,c=a.map(function(a){var c=a.first_name+" "+a.last_name;return b+=a.endorsements,{name:c,data:a.endorsements}});return{dataPoints:c,total:b}})}}}),b.otherwise("/about"),d.setOptions({chartColors:["#E8EDF1"],defaultFontSize:25,responsive:!1}),c.defaults.useXDomain=!0,delete c.defaults.headers.common["X-Requested-With"],e.config({domains:{development:["localhost","dev.local"],production:["rundnc.herokuapp.com"],staging:["rundncstaging.herokuapp.com"]}}),e.check()}).run(function(a,b){var c;"development"===b.get()?c="":"staging"===b.get()?c="https://rundncstaging.herokuapp.com":"production"===b.get()&&(c="https://rundnc.herokuapp.com"),a.baseUrl=c}),angular.module("dncElection").controller("AboutCtrl",function(a,b){console.log("candidates",b),a.candidates=b}),angular.module("dncElection").controller("CandidatesCtrl",function(a,b,c,d,e){a.platform=b.platform.replace(/\n\r?/g,"<br />"),a.candidate=b,a.openEndorseModal=function(){var f=c.open({ariaLabelledBy:"modal-title",templateUrl:"templates/endorseModal.html",controller:"EndorseCtrl",size:"md",resolve:{candidate:function(){return a.candidate}}});f.result.then(function(c){e.passingData({user:c.user,candidate:a.candidate});!!c.created;return d.go("electorResults",{userId:c.user._id,created:c.created,candidate:b})})}}).controller("EndorseCtrl",function(a,b,c,d){a.candidate=b,a.confirmed=!1,a.errored=!1,a.ok=function(){a.confirmed||(a.confirmed=!0)},a.endorse=function(b){if(b)return"null"===b.gender&&(b.gender=null),b.endorsed=a.candidate._id,d.create(b).then(function(a){c.close(a.data)})},a.confirm=function(){a.confirmed=!0},a.cancel=function(){c.dismiss("cancel")}}),angular.module("dncElection").controller("ElectorCtrl",function(a,b,c){a.formFilled=!1,a.messageTypes=!1,a.pickedEmail=!1,a.pickedText=!1,a.pickedPostcard=!1,a.emailSent=!1,a.chooseElector=!1,a.get_electors=function(a){c.go("electorResults",{user:a})},a.get_electors=function(c){b.getElectors(c).then(function(b){console.log(b),a.formFilled=!0,a.electors=b,a.chooseElector=!0})},a.get_state=function(c){b.getState(c).then(function(b){console.log(b),a.formFilled=!0})},a.chooseMessage=function(b){a.messageTypes=!0,a.selectedElector=b},a.pickEmail=function(){a.pickedEmail=!0,a.pickedPostcard=!1},a.pickPostcard=function(){a.pickedPostcard=!0,a.pickedEmail=!1},a.sendEmail=function(b,c){a.pickedEmail=!1,a.emailSent=!0},a.sendPostcard=function(c,d){a.pickedPostcard=!1;var e={message:c,id:d._id,state:d.state};b.postcard(e).then(function(b){console.log(b),a.postcardSent=!0})}}),angular.module("dncElection").controller("ElectorResultsCtrl",function(a,b,c,d,e,f){a.electors=d,a.created=e,a.chooseElector=!0,a.messageTypes=!1,a.pickedEmail=!1,a.pickedText=!1,a.pickedPostcard=!1,a.emailSent=!1,a.candidate=f.postcardData.candidate,a.user=f.postcardData.user,console.log("user",a.user),a.chooseMessage=function(b){a.messageTypes=!0,a.selectedElector=b,a.chooseElector=!1},a.pickEmail=function(){a.pickedEmail=!0,a.pickedPostcard=!1},a.pickPostcard=function(){a.pickedPostcard=!0,a.pickedEmail=!1};var g="Thoughts%20on%20the%20DNC%20Chair",h="Dear DNC Elector, ";a.sendEmail=function(a,c){var d=a.length?a:h,e=c.personal_email||"fake@gmail.com";b.open("mailto:"+e+"?subject="+g+"&body="+d)},a.sendPostcard=function(b){a.pickedPostcard=!1,a.postcardSent=!0;var c={message:b.message,name:b.first_name+b.last_name,street_address:b.street_address,city:b.city,state:b.state,zip:b.zip,candidate:a.candidate._id,user_id:a.user._id};f.sendPostcard(c).then(function(a){console.log(a)})}}),angular.module("dncElection").controller("ResultsCtrl",function(a){this.data=a}).directive("resultsChart",function(a){return{restrict:"EA",scope:{chartData:"="},template:"<div id='results-chart' class='results-chart'></div>",link:function(b,c,d){console.log("results");var e,f,g,h,i=a.d3,j=(i.select("#results-chart").append("div").attr("class","toolTip"),20),k=40,l=4,m=parseInt(i.select("#results-chart").style("width"),10),n=parseInt(i.select("#results-chart").style("height"),10),o=.4*(n-j-2*k)/b.chartData.dataPoints.length,p=.6*(n-j-2*k)/b.chartData.dataPoints.length,q=0;max=i.max(b.chartData.dataPoints,function(a){return a.data});var f=i.select("#results-chart").append("svg").attr("width",m).attr("height",n);e=f.selectAll("g").data(b.chartData.dataPoints).enter().append("g"),e.attr("class","bar").attr("cx",0).attr("transform",function(a,b){return"translate("+k+","+(b*(o+p)+p)+")"}),e.append("text").attr("class","name").attr("y",o/2).attr("dy",".35em").text(function(a){return a.name}).each(function(){q=Math.ceil(Math.max(q,this.getBBox().width))});var g=i.scaleLinear().domain([0,max]).range([0,m-2*k-q]);h=i.axisBottom().scale(g).tickSize(-n+2*k+j),e.append("rect").attr("transform","translate("+q+", 0)").attr("height",o).attr("width",function(a){return g(a.data)}),e.append("text").attr("class","data").attr("y",o/2).attr("dx",-l+q).attr("dy",".35em").attr("text-anchor","end").text(function(a){return parseInt(a.data/b.chartData.total*100)+"%"}).attr("x",function(a){var b=this.getBBox().width;return Math.max(b+l,g(a.data))}),f.insert("g",":first-child").attr("class","axisHorizontal").attr("transform","translate("+(k+q)+","+(n-j-k)+")").call(h)}}}),angular.module("dncElection").directive("candidateBox",function(){return{templateUrl:"templates/candidateBox.html",scope:{candidate:"="},controllerAs:"candidateBoxCtrl",bindToController:!0,controller:function(){}}}),angular.module("dncElection").factory("CandidateService",function(a){var b={getCandidates:function(){return a.get("/candidates",{cache:!0}).then(function(a){return a.data})},getCandidate:function(a){}};return b}),angular.module("dncElection").service("ElectorService",function(a){var b={getElectors:function(b){return a.get("/users/"+b+"/electors").then(function(a){return a.data})},createUser:function(b){return a.post("/users/create",b).then(function(a){return a.data})},getState:function(b){return a.get("/electors/getStateElectors/"+b).then(function(a){return a.data})},email:function(b){return a.post("/emails/email",b).then(function(a){return a.data})},postcard:function(b){return a.post("/postcards/postcard",b).then(function(a){return a.data})}};return b}),angular.module("dncElection").factory("PostcardService",function(a){var b={postcardData:{},passingData:function(a){this.postcardData=a},sendPostcard:function(b){return a.post("/postcards/postcard",b).then(function(a){return a.data})}};return b}),angular.module("dncElection").service("UserService",function(a){var b={create:function(b){return a.post("/users/endorse",b)}};return b});